version: "3.8"

services:
  db:
    image: postgres
    # Include container:host port mapping if you want to see this externally
    # ports:
    #   - 5432:5432
    volumes:
      # Named volume is not necessary for this, can mount to the system
      # See "Where to Store Data" in https://hub.docker.com/_/postgres
      - data-db:/var/lib/postgresql/data
      - ./db:/docker-entrypoint-initdb.d # automatically run schema.sql
    environment:
      POSTGRES_PASSWORD: keepitsecretkeepitsafe
      POSTGRES_USER: pgadmin
      POSTGRES_DB: db

  web:
    build: .
    depends_on:
      - db
    command: dev.sh
    expose:
      # internal
      - 8000
    volumes:
      # Mount the code so you can edit and see changes.
      - ./:/app/src
    env_file:
      - .secrets-example
      - .secrets

  nginx:
    build: ./services/nginx
    ports:
      # external
      - 80:8080
    depends_on:
      - web

volumes:
  data-db:
